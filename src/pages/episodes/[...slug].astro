---
import { getCollection } from 'astro:content';
import EpisodeLayout from '../../layouts/EpisodeLayout.astro';
import Admonition from '../../components/content/Admonition.astro';

export async function getStaticPaths() {
  const episodes = await getCollection('episodes', ({ data }) => !data.draft);
  return episodes.map((episode) => ({
    params: { slug: episode.slug },
    props: { episode },
  }));
}

const { episode } = Astro.props;
const { Content } = await episode.render();
const base = import.meta.env.BASE_URL;
const ogImage = `${base}/og/episodes/${episode.slug}.png`;
---

<EpisodeLayout
  title={episode.data.title}
  description={episode.data.description}
  pubDate={episode.data.pubDate}
  episodeNumber={episode.data.episodeNumber}
  youtubeId={episode.data.youtubeId}
  spotifyUrl={episode.data.spotifyUrl}
  appleMusicUrl={episode.data.appleMusicUrl}
  tags={episode.data.tags}
  ogImage={ogImage}
>
  <Content components={{ Admonition }} />
</EpisodeLayout>
