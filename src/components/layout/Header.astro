---
import Navigation from './Navigation.astro';

const currentPath = Astro.url.pathname;
const base = import.meta.env.BASE_URL;
---

<header class="border-b border-terminal-greenDim bg-terminal-black sticky top-0 z-50">
  <div class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between gap-4">
      <!-- Logo/Brand -->
      <a href={`${base}/`} class="flex items-center space-x-2 no-underline hover:no-underline flex-shrink-0">
        <span class="text-terminal-green text-2xl font-bold">></span>
        <span class="text-terminal-green text-xl font-bold hidden sm:inline">
          The Copilot Stack
        </span>
        <span class="text-terminal-green text-2xl animate-pulse">_</span>
      </a>

      <!-- Search -->
      <div class="flex-grow max-w-md hidden md:block">
        <div id="header-search"></div>
      </div>

      <!-- Mobile Search Button -->
      <button
        id="mobile-search-toggle"
        class="md:hidden text-terminal-green hover:text-terminal-greenDim transition-colors"
        aria-label="Toggle search"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </button>

      <!-- Navigation -->
      <Navigation currentPath={currentPath} />
    </div>

    <!-- Mobile Search (Hidden by default) -->
    <div id="mobile-search" class="hidden md:hidden mt-4 pb-2"></div>
  </div>
</header>

<link href="/the-copilot-stack/pagefind/pagefind-ui.css" rel="stylesheet" is:inline />
<script src="/the-copilot-stack/pagefind/pagefind-ui.js" is:inline></script>

<script>
  window.addEventListener('DOMContentLoaded', () => {
    if (typeof window !== 'undefined' && (window as any).PagefindUI) {
      // Desktop search
      const desktopSearch = document.getElementById('header-search');
      if (desktopSearch) {
        new (window as any).PagefindUI({
          element: '#header-search',
          showSubResults: true,
          showImages: false,
          excerptLength: 15,
          resetStyles: false,
          translations: {
            placeholder: 'Search...',
          },
        });
      }

      // Mobile search
      const mobileSearch = document.getElementById('mobile-search');
      if (mobileSearch) {
        new (window as any).PagefindUI({
          element: '#mobile-search',
          showSubResults: true,
          showImages: false,
          excerptLength: 15,
          resetStyles: false,
          translations: {
            placeholder: 'Search The Copilot Stack...',
          },
        });
      }

      // Mobile search toggle
      const mobileSearchToggle = document.getElementById('mobile-search-toggle');
      mobileSearchToggle?.addEventListener('click', () => {
        mobileSearch?.classList.toggle('hidden');
        if (!mobileSearch?.classList.contains('hidden')) {
          const input = mobileSearch?.querySelector('input') as HTMLInputElement;
          input?.focus();
        }
      });

      // Close mobile search when clicking outside
      document.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        if (!mobileSearch?.contains(target) && !mobileSearchToggle?.contains(target)) {
          mobileSearch?.classList.add('hidden');
        }
      });
    }
  });
</script>

<style is:global>
  @keyframes pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0;
    }
  }

  .animate-pulse {
    animation: pulse 1s ease-in-out infinite;
  }

  /* Pagefind terminal theme */
  .pagefind-ui__search-input {
    background-color: #1a1a1a !important;
    color: #00FF00 !important;
    border: 1px solid #00AA00 !important;
    border-radius: 0.375rem !important;
    font-family: 'JetBrains Mono', monospace !important;
    padding: 0.5rem 1rem !important;
    font-size: 0.875rem !important;
  }

  .pagefind-ui__search-input:focus {
    outline: none !important;
    border-color: #00FF00 !important;
    box-shadow: 0 0 0 2px rgba(0, 255, 0, 0.1) !important;
  }

  .pagefind-ui__search-input::placeholder {
    color: #00AA00 !important;
  }

  .pagefind-ui__results-area {
    margin-top: 1rem !important;
  }

  .pagefind-ui__result {
    background-color: #1a1a1a !important;
    border: 1px solid #00AA00 !important;
    border-radius: 0.5rem !important;
    padding: 1rem !important;
    margin-bottom: 0.75rem !important;
    transition: all 0.2s ease !important;
  }

  .pagefind-ui__result:hover {
    border-color: #00FF00 !important;
    background-color: #1f1f1f !important;
  }

  .pagefind-ui__result-link {
    text-decoration: none !important;
  }

  .pagefind-ui__result-title {
    color: #00FF00 !important;
    font-weight: bold !important;
    font-family: 'JetBrains Mono', monospace !important;
  }

  .pagefind-ui__result-excerpt {
    color: #C5C5C5 !important;
    font-family: 'JetBrains Mono', monospace !important;
    font-size: 0.875rem !important;
    margin-top: 0.5rem !important;
  }

  .pagefind-ui__result-excerpt mark {
    background-color: rgba(0, 255, 0, 0.2) !important;
    color: #00FF00 !important;
    font-weight: bold !important;
  }

  .pagefind-ui__message {
    color: #00AA00 !important;
    font-family: 'JetBrains Mono', monospace !important;
  }

  .pagefind-ui__button {
    background-color: #00FF00 !important;
    color: #0a0a0a !important;
    font-weight: bold !important;
    font-family: 'JetBrains Mono', monospace !important;
    border-radius: 0.375rem !important;
    border: none !important;
    padding: 0.5rem 1rem !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
  }

  .pagefind-ui__button:hover {
    background-color: #00AA00 !important;
  }

  .pagefind-ui__search-clear {
    color: #00AA00 !important;
  }

  .pagefind-ui__search-clear:hover {
    color: #00FF00 !important;
  }
</style>
