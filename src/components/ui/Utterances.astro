---
// Utterances comments widget for blog posts
// Uses GitHub issues for comments storage
---

<div id="utterances-container" class="mt-12 pt-8 border-t border-terminal-greenDim">
  <div class="utterances-wrapper"></div>
</div>

<script>
  function loadUtterances() {
    const container = document.querySelector('.utterances-wrapper');
    if (!container) return;

    // Check if already loaded
    if (container.querySelector('.utterances')) return;

    const script = document.createElement('script');
    script.src = 'https://utteranc.es/client.js';
    script.setAttribute('repo', 'sebastienlevert/copilot-stack');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-dark');
    script.setAttribute('crossorigin', 'anonymous');
    script.setAttribute('async', 'true');

    container.appendChild(script);
  }

  // Load on initial page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadUtterances);
  } else {
    loadUtterances();
  }

  // Reload on Astro view transitions
  document.addEventListener('astro:page-load', loadUtterances);
</script>

<style>
  .utterances-wrapper {
    min-height: 200px;
  }

  .utterances-wrapper :global(.utterances) {
    max-width: 100%;
  }

  .utterances-wrapper :global(.utterances-frame) {
    border: 1px solid var(--terminal-greenDim);
    border-radius: 0.5rem;
  }
</style>
