---
import { getCollection } from 'astro:content';
import BlogCard from './BlogCard.astro';

const base = import.meta.env.BASE_URL;

const allBlogPosts = await getCollection('blog', ({ data }) => {
  return !data.draft;
});

// Sort by date, newest first
const sortedPosts = allBlogPosts.sort((a, b) =>
  b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<div class="blog-list grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {sortedPosts.map((post) => (
    <BlogCard
      slug={post.slug}
      title={post.data.title}
      description={post.data.description}
      pubDate={post.data.pubDate}
      tags={post.data.tags}
      content={post.body}
      ogImage={`${base}/og/blog/${post.slug}.png`}
    />
  ))}
</div>

{sortedPosts.length === 0 && (
  <div class="text-center py-12">
    <p class="text-terminal-greenDim text-base terminal-prompt">
      No blog posts found. Check back soon!
    </p>
  </div>
)}
